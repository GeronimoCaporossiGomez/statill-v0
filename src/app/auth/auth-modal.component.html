<!-- Fondo oscuro -->
<div class="auth-modal-backdrop" (click)="close.emit()"></div>

<!-- Modal centrado -->
<div class="auth-modal">
  <!-- Logo y título -->
  <div class="auth-logo-title">
    <img src="assets/img/logo.png" alt="Statill Logo" class="auth-logo" />
    <span class="auth-title">Statill</span>
  </div>

  <!-- Tabs de navegación (ocultas durante verificación de código) -->
  <div class="auth-header" *ngIf="!isVerifyingCode">
    <div class="tabs">
      <div class="tab" [class.active]="!isLogin" (click)="toggleMode(false)">
        Registro
      </div>
      <div class="tab" [class.active]="isLogin" (click)="toggleMode(true)">
        Iniciar sesión
      </div>
      <div class="active-bar" [class.move-right]="isLogin"></div>
    </div>
  </div>

  <!-- Formulario con animación -->
  <div class="auth-body" [@fadeSlide]="isLogin ? 'login' : 'register'">
    <!-- Mensajes de éxito/error -->
    <div
      *ngIf="message"
      class="auth-message"
      [class.success]="messageType === 'success'"
      [class.error]="messageType === 'error'"
    >
      {{ message }}
    </div>

    <!-- Paso: Verificación de código -->
    <form *ngIf="isVerifyingCode" (ngSubmit)="submitForm()">
      <div class="form-group">
        <label for="activation">Código de verificación</label>
        <input
          id="activation"
          type="text"
          placeholder="Ingresá tu código"
          [(ngModel)]="activationCode"
          name="activation"
          [disabled]="loading"
          required
        />
      </div>
      <button type="submit" class="btn btn-primary" [disabled]="loading">
        <span *ngIf="loading">Verificando...</span>
        <span *ngIf="!loading">Confirmar</span>
      </button>
      <div class="resend-section">
        <p>¿No recibiste el código?</p>
        <button
          type="button"
          class="btn btn-link"
          (click)="resendVerificationCode()"
          [disabled]="loading"
        >
          Reenviar código
        </button>
      </div>
      <button
        type="button"
        class="btn btn-link"
        (click)="backToLogin()"
        [disabled]="loading"
      >
        Volver al login
      </button>
    </form>

    <!-- Paso: Login / Registro -->
    <form *ngIf="!isVerifyingCode" (ngSubmit)="submitForm()">
      <!-- Solo en registro -->
      <ng-container *ngIf="!isLogin">
        <div class="form-grid">
          <div class="form-group">
            <label for="first_names">Nombre</label>
            <input
              id="first_names"
              type="text"
              placeholder="Ingresa tu nombre"
              [(ngModel)]="first_names"
              name="first_names"
              required
            />
          </div>

          <div class="form-group">
            <label for="last_name">Apellido</label>
            <input
              id="last_name"
              type="text"
              placeholder="Ingresa tu apellido"
              [(ngModel)]="last_name"
              name="last_name"
              required
            />
          </div>

          <div class="form-group">
            <label for="birthdate">Fecha de nacimiento</label>
            <input
              id="birthdate"
              type="date"
              [(ngModel)]="birthdate"
              name="birthdate"
              required
            />
          </div>

          <div class="form-group">
            <label for="gender">Género</label>
            <select id="gender" [(ngModel)]="gender" name="gender" required>
              <option value="">Seleccione</option>
              <option value="M">Masculino</option>
              <option value="F">Femenino</option>
              <option value="X">Otro</option>
            </select>
          </div>

          <div class="form-group full-width">
            <label for="res_area">Zona de residencia</label>
            <input
              id="res_area"
              type="text"
              placeholder="Ej: Vicente López"
              [(ngModel)]="res_area"
              name="res_area"
              required
            />
          </div>
        </div>
      </ng-container>

      <div class="form-group">
        <label for="email">Correo electrónico</label>
        <input
          id="email"
          type="email"
          placeholder="ejemplo@gmail.com"
          [(ngModel)]="email"
          name="email"
          required
        />
      </div>

      <div class="form-group">
        <label for="password">Contraseña</label>
        <input
          id="password"
          type="password"
          [placeholder]="
            isLogin ? 'Ingresá tu contraseña' : 'Ingresar +8 caracteres'
          "
          [(ngModel)]="password"
          name="password"
          [disabled]="loading"
          required
        />
      </div>

      <!-- Términos y condiciones solo en registro -->
      <div *ngIf="!isLogin" class="terms">
        <span class="terms-icon">&#9888;</span>
        <span
          >Al registrarse, está aceptando los
          <a href="#" class="terms-link">términos y condiciones</a></span
        >
      </div>
      <button type="submit" class="btn btn-primary" [disabled]="loading">
        <span *ngIf="loading">Cargando...</span>
        <span *ngIf="!loading">{{
          isLogin ? "Iniciar sesión" : "Registrarse"
        }}</span>
      </button>
    </form>

    <!-- Divider y cambio de modo -->
    <div class="divider">
      <span>O</span>
    </div>

    <div class="switch-mode" *ngIf="!isVerifyingCode">
      <span *ngIf="!isLogin"
        >¿Ya tenés cuenta?
        <a (click)="toggleMode(true)" class="switch-link"
          >Iniciá sesión</a
        ></span
      >
      <span *ngIf="isLogin"
        >¿No tenés cuenta?
        <a (click)="toggleMode(false)" class="switch-link">Registrate</a></span
      >
    </div>

    <!-- Cierre del modal -->
    <button class="close-btn" (click)="close.emit()">Cerrar</button>
  </div>
</div>
