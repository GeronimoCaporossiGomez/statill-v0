<section class="stock-page">
  <h1>üì¶ Gesti√≥n de Stock</h1>

  <!-- FORMULARIO -->
  <form [formGroup]="productoForm" (ngSubmit)="agregarProducto()" class="formulario">

    <div class="grupo">
      <label>Nombre</label>
      <input formControlName="nombre" type="text" placeholder="Ej: Galletitas" />
      <span *ngIf="mostrarError('nombre')">‚ö†Ô∏è Campo obligatorio</span>
    </div>

    <div class="grupo">
      <label>Descripci√≥n</label>
      <textarea formControlName="descripcion" rows="2" placeholder="Opcional..."></textarea>
    </div>

    <div class="grupo">
      <label>Precio ($)</label>
      <input formControlName="precio" type="number" step="0.01" min="0" />
      <span *ngIf="mostrarError('precio')">‚ö†Ô∏è Ingres√° un valor v√°lido</span>
    </div>

    <div class="grupo">
      <label>Stock</label>
      <input formControlName="stock" type="number" min="0" />
      <span *ngIf="mostrarError('stock')">‚ö†Ô∏è Debe ser 0 o mayor</span>
    </div>

    <div class="grupo">
      <label>C√≥digo de barras</label>
      <div class="codigo-barras">
        <input formControlName="codigoBarras" type="text" />
        <button type="button" (click)="abrirScanner()">üì∑</button>
      </div>
      <span *ngIf="mostrarError('codigoBarras')">‚ö†Ô∏è Campo obligatorio</span>
    </div>

    <div class="grupo">
      <label>Imagen del producto</label>
      <input type="file" accept="image/*" (change)="manejarImagen($event)" />
      <img *ngIf="imagenBase64" [src]="imagenBase64" alt="Preview" class="preview-img" />
    </div>

    <button type="submit">‚ûï A√±adir producto</button>
  </form>

  <!-- ESC√ÅNER -->
  <div class="scanner-overlay" *ngIf="mostrarScanner">
    <div class="scanner-container">
      <video autoplay></video>
      <button class="btn-cerrar" (click)="cerrarScanner()">‚úñ</button>
    </div>
  </div>

  <!-- ALERTA -->
  <div *ngIf="alertaStockBajo()" class="alerta-stock">
    ‚ö†Ô∏è ¬°Producto con stock bajo! Consider√° reponerlo.
  </div>

  <!-- LISTA DE PRODUCTOS -->
  <div class="lista-productos" *ngIf="productos().length > 0">
    <h2>üìã Productos a√±adidos ({{ totalProductos() }})</h2>
    <ul>
      <li *ngFor="let p of productos(); index as i">
        <img *ngIf="p.imagen" [src]="p.imagen" alt="Img producto" />
        <div class="info">
          <strong>{{ p.nombre }}</strong><br />
          C√≥digo: {{ p.codigoBarras }}<br />
          Stock: {{ p.stock }} | ${{ p.precio }}
        </div>
        <button (click)="eliminarProducto(i)">üóëÔ∏è</button>
      </li>
    </ul>
  </div>

  <p *ngIf="productos().length === 0" class="sin-productos">No hay productos a√∫n.</p>
</section>
