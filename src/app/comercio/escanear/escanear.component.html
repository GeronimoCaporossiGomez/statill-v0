<app-sidebar></app-sidebar>

<div class="contenedor-principal">
  <!-- Secci√≥n de c√°mara y esc√°ner -->
  <div class="seccion-camara">
    <div class="cuadrado-escanear">
      <h1>üì∑ Escanear C√≥digos de Barras</h1>
      <div class="color-box">
        <div class="scanner-info">
          <span class="scanner-icon">üìä</span>
          <p>Escanea c√≥digos de barras para buscar productos o crear nuevos</p>
        </div>
      </div>
    </div>

    <div class="scanner-container">
      <h2>C√°mara y Esc√°ner</h2>

      <div *ngIf="errorMessage" class="message" 
           [ngClass]="{'success': errorMessage.includes('exitosamente'), 'error': !errorMessage.includes('exitosamente') && !errorMessage.includes('Escaneando')}">
        {{ errorMessage }}
      </div>

      <div class="video-container">
        <video #video autoplay playsinline width="600" height="400" 
               [class.scanning]="isScanning"></video>
        <div *ngIf="isScanning" class="scanning-overlay">
          <div class="scanning-line"></div>
          <p>Escaneando c√≥digo de barras...</p>
        </div>
      </div>

      <div class="camera-controls">
        <button (click)="toggleCamera()" class="btn-primary">
          {{ isCameraOn ? 'üìπ Apagar c√°mara' : 'üì∑ Encender c√°mara' }}
        </button>
        <button (click)="startScanning()" [disabled]="!isCameraOn || isScanning" class="btn-scan">
          {{ isScanning ? '‚è≥ Escaneando...' : 'üîç Escanear c√≥digo' }}
        </button>
        <button (click)="stopScanning()" [disabled]="!isScanning" class="btn-stop">
          ‚èπÔ∏è Detener escaneo
        </button>
      </div>
    </div>
  </div>

  <!-- Secci√≥n de resultados y formularios -->
  <div class="seccion-formulario">
    
    <!-- Mostrar productos encontrados -->
    <div *ngIf="foundProducts.length > 0 && !showCreateForm" class="productos-encontrados">
      <h2>‚úÖ Productos Encontrados</h2>
      <div class="producto-info">
        <div class="producto-header">
          <h3>{{ displayData.nombre }}</h3>
          <span class="codigo-badge">{{ displayData.codigo }}</span>
        </div>
        <div class="producto-details">
          <p><strong>Marca:</strong> {{ displayData.marca }}</p>
          <p><strong>Precio:</strong> {{ displayData.precio }}</p>
          <p><strong>Categor√≠a:</strong> {{ displayData.tipo }}</p>
          <p><strong>Fecha:</strong> {{ displayData.fecha }}</p>
        </div>
      </div>
      
      <div class="multiple-products" *ngIf="foundProducts.length > 1">
        <p><strong>{{ foundProducts.length - 1 }} producto(s) m√°s con este c√≥digo</strong></p>
        <button class="btn-secondary">Ver todos</button>
      </div>
    </div>

    <!-- Formulario de crear producto -->
    <div *ngIf="showCreateForm" class="crear-producto-form">
      <h2>‚ûï Crear Nuevo Producto</h2>
      <p class="form-description">C√≥digo escaneado: <strong>{{ newProduct.barcode }}</strong></p>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="name">Nombre del producto *</label>
          <input 
            type="text" 
            id="name"
            [(ngModel)]="newProduct.name" 
            placeholder="Ingresa el nombre del producto"
            class="form-input"
            required>
        </div>

        <div class="form-group">
          <label for="brand">Marca</label>
          <input 
            type="text" 
            id="brand"
            [(ngModel)]="newProduct.brand" 
            placeholder="Marca del producto"
            class="form-input">
        </div>

        <div class="form-group">
          <label for="price">Precio *</label>
          <input 
            type="number" 
            id="price"
            [(ngModel)]="newProduct.price" 
            placeholder="0.00"
            class="form-input"
            min="0"
            step="0.01"
            required>
        </div>

        <div class="form-group">
          <label for="quantity">Cantidad</label>
          <input 
            type="number" 
            id="quantity"
            [(ngModel)]="newProduct.quantity" 
            placeholder="1"
            class="form-input"
            min="1">
        </div>

        <div class="form-group">
          <label for="type">Categor√≠a</label>
          <select 
            id="type"
            [(ngModel)]="newProduct.type" 
            class="form-select">
            <option value="">Seleccionar categor√≠a</option>
            <option *ngFor="let tipo of tiposProducto" [value]="tipo.id">
              {{ tipo.name }}
            </option>
          </select>
        </div>

        <div class="form-group full-width">
          <label for="description">Descripci√≥n</label>
          <textarea 
            id="description"
            [(ngModel)]="newProduct.description" 
            placeholder="Descripci√≥n del producto"
            class="form-textarea"
            rows="3"></textarea>
        </div>
      </div>

      <div class="form-actions">
        <button (click)="createProduct()" [disabled]="isLoading" class="btn-create">
          {{ isLoading ? '‚è≥ Creando...' : '‚úÖ Crear Producto' }}
        </button>
        <button (click)="resetForm()" class="btn-cancel">
          ‚ùå Cancelar
        </button>
      </div>
    </div>

    <!-- Informaci√≥n b√°sica cuando no hay datos -->
    <div *ngIf="!showCreateForm && foundProducts.length === 0" class="info-inicial">
      <h2>üìä Informaci√≥n del Escaneo</h2>
      <div class="info-placeholder">
        <div class="placeholder-icon">üîç</div>
        <p>Enciende la c√°mara y escanea un c√≥digo de barras para comenzar</p>
        <div class="steps">
          <div class="step">1Ô∏è‚É£ Enciende la c√°mara</div>
          <div class="step">2Ô∏è‚É£ Inicia el escaneo</div>
          <div class="step">3Ô∏è‚É£ Apunta al c√≥digo de barras</div>
        </div>
      </div>
    </div>

    <!-- Bot√≥n de limpiar siempre visible -->
    <div class="acciones-formulario">
      <button (click)="limpiarTodo()" class="btn-clean">
        üßπ Limpiar Todo
      </button>
    </div>
  </div>
</div>
