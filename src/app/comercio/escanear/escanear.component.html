<app-sidebar></app-sidebar>

<div class="contenedor-principal">
  <!-- SecciÃ³n de cÃ¡mara y escÃ¡ner -->
  <div class="seccion-camara">
    <div class="cuadrado-escanear">
      <h1>ğŸ“· Escanear CÃ³digos de Barras</h1>
      <div class="color-box">
        <div class="scanner-info">
          <span class="scanner-icon">ğŸ“Š</span>
          <p>Escanea cÃ³digos de barras para buscar productos o crear nuevos</p>
        </div>
      </div>
    </div>

    <div class="scanner-container">
      <h2>CÃ¡mara y EscÃ¡ner</h2>

      <div *ngIf="errorMessage" class="message" 
           [ngClass]="{'success': errorMessage.includes('exitosamente'), 'error': !errorMessage.includes('exitosamente') && !errorMessage.includes('Escaneando')}">
        {{ errorMessage }}
      </div>

      <div class="video-container">
        <div #video id="scanner-container" 
             [class.scanning]="isScanning"></div>
        <div *ngIf="isScanning" class="scanning-overlay">
          <div class="scanning-line"></div>
          <p>Escaneando cÃ³digo de barras...</p>
        </div>
      </div>

      <div class="camera-controls">
        <button (click)="toggleCamera()" class="btn-primary">
          {{ isCameraOn ? 'ğŸ“¹ Apagar cÃ¡mara' : 'ğŸ“· Encender cÃ¡mara' }}
        </button>
        <button (click)="startScanning()" [disabled]="!isCameraOn || isScanning" class="btn-scan">
          {{ isScanning ? 'â³ Escaneando...' : 'ğŸ” Escanear cÃ³digo' }}
        </button>
        <button (click)="stopScanning()" [disabled]="!isScanning" class="btn-stop">
          â¹ï¸ Detener escaneo
        </button>
      </div>
    </div>
  </div>

  <!-- SecciÃ³n de resultados y formularios -->
  <div class="seccion-formulario">
    
    <!-- Mostrar productos encontrados -->
    <div *ngIf="foundProducts.length > 0 && !showCreateForm" class="productos-encontrados">
      <h2>âœ… Productos Encontrados</h2>
      <div class="producto-info">
        <div class="producto-header">
          <h3>{{ displayData.nombre }}</h3>
          <span class="codigo-badge">{{ displayData.codigo }}</span>
        </div>
        <div class="producto-details">
          <p><strong>Marca:</strong> {{ displayData.marca }}</p>
          <p><strong>Precio:</strong> {{ displayData.precio }}</p>
          <p><strong>CategorÃ­a:</strong> {{ displayData.tipo }}</p>
          <p><strong>Fecha:</strong> {{ displayData.fecha }}</p>
        </div>
      </div>
      
      <div class="multiple-products" *ngIf="foundProducts.length > 1">
        <p><strong>{{ foundProducts.length - 1 }} producto(s) mÃ¡s con este cÃ³digo</strong></p>
        <button class="btn-secondary">Ver todos</button>
      </div>
    </div>

    <!-- Formulario de crear producto (basado en stock.component) -->
    <div *ngIf="showCreateForm" class="crear-producto-form">
      <h2>â• Crear Nuevo Producto</h2>
      <p class="form-description">CÃ³digo escaneado: <strong>{{ scannedBarcode }}</strong></p>
      <p *ngIf="currentStore" class="store-info">Creando producto para: <strong>{{ currentStore.name }}</strong> (ID: {{ currentStore.id }})</p>
      
      <!-- Mostrar informaciÃ³n de productos similares encontrados -->
      <div *ngIf="foundProducts.length > 0" class="productos-similares">
        <h3>ğŸ“‹ Productos similares encontrados:</h3>
        <div class="similar-products-list">
          <div *ngFor="let product of foundProducts" class="similar-product">
            <span class="product-name">{{ product.name }}</span>
            <span class="product-brand">{{ product.brand }}</span>
            <span class="product-store">Tienda #{{ product.store_id }}</span>
          </div>
        </div>
        <p class="similar-info">Los datos de nombre y marca se han prellenado automÃ¡ticamente. Complete los campos faltantes.</p>
      </div>
      
      <!-- Formulario basado en stock.component -->
      <div class="producto-card producto-form-card">
        <div class="producto-img">
          <div class="img-placeholder">
            <span>ğŸ–¼ï¸</span>
          </div>
        </div>
        <div class="producto-info">
          <input 
            type="text" 
            class="producto-nombre-input" 
            placeholder="Nombre del producto..." 
            [(ngModel)]="product.name" />
          <input 
            type="text" 
            class="producto-desc-input" 
            placeholder="Describe el producto aquÃ­..." 
            [(ngModel)]="product.description" />
        </div>
        <div class="producto-precio">
          <label for="precio-input" class="producto-nombre"> Precio:</label>
          <input 
            type="number" 
            id="precio-input"
            class="producto-cantidad-input" 
            placeholder="Precio..." 
            [(ngModel)]="product.price" 
            min="1"/>
        </div>
        <div class="producto-cantidad">
          <label for="cantidad-input" class="producto-nombre"> Cantidad:</label>
          <input 
            type="number" 
            id="cantidad-input" 
            class="producto-cantidad-input" 
            placeholder="Cantidad..." 
            [(ngModel)]="product.cantidad" 
            min="1" />
        </div>
        <div class="producto-editar">
          <button class="submit-button" (click)="GuardarData()" [disabled]="isLoading">
            <span>{{ isLoading ? 'â³' : 'âœ”ï¸' }}</span>
          </button>
        </div>
      </div>
    </div>

    <!-- InformaciÃ³n bÃ¡sica cuando no hay datos -->
    <div *ngIf="!showCreateForm && foundProducts.length === 0" class="info-inicial">
      <h2>ğŸ“Š InformaciÃ³n del Escaneo</h2>
      <div class="info-placeholder">
        <div class="placeholder-icon">ğŸ”</div>
        <p>Enciende la cÃ¡mara y escanea un cÃ³digo de barras para comenzar</p>
        <div class="steps">
          <div class="step">1ï¸âƒ£ Enciende la cÃ¡mara</div>
          <div class="step">2ï¸âƒ£ Inicia el escaneo</div>
          <div class="step">3ï¸âƒ£ Apunta al cÃ³digo de barras</div>
        </div>
      </div>
    </div>

    <!-- BotÃ³n de limpiar siempre visible -->
    <div class="acciones-formulario">
      <button (click)="limpiarTodo()" class="btn-clean">
        ğŸ§¹ Limpiar Todo
      </button>
    </div>
  </div>
</div>