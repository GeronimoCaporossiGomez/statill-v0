<app-sidebar></app-sidebar>

<div class="contenedor-principal">
  <!-- Header de la pÃ¡gina -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <span class="icon">ğŸ“±</span>
        EscÃ¡ner de Productos
      </h1>
      <p class="page-subtitle">Escanea cÃ³digos de barras para crear o buscar productos</p>
    </div>
  </div>

  <!-- SecciÃ³n de cÃ¡mara -->
  <div class="seccion-camara">
    <!-- InformaciÃ³n de la tienda -->
    <div *ngIf="currentStore" class="store-info-card">
      <div class="store-icon">ğŸª</div>
      <div class="store-details">
        <h3>{{ currentStore.name }}</h3>
        <p>ğŸ“ {{ currentStore.address }}</p>
      </div>
    </div>

    <!-- Contenedor de la cÃ¡mara -->
    <div class="camera-section">
      <div class="camera-header">
        <h2>ğŸ“· CÃ¡mara de Escaneo</h2>
        <div class="camera-status" [ngClass]="{'active': isCameraOn, 'inactive': !isCameraOn}">
          <span class="status-dot"></span>
          {{ isCameraOn ? 'Activa' : 'Inactiva' }}
        </div>
      </div>

      <div class="video-container">
        <div #video id="scanner-container"></div>
        <div class="video-overlay" *ngIf="!isCameraOn">
          <div class="overlay-content">
            <div class="overlay-icon">ğŸ“·</div>
            <p>CÃ¡mara desactivada</p>
            <small>Presiona "Activar CÃ¡mara" para comenzar</small>
          </div>
        </div>
        <div class="scanning-overlay" *ngIf="isScanning">
          <div class="scanning-animation">
            <div class="scan-line"></div>
            <p>Escaneando...</p>
          </div>
        </div>
      </div>

      <!-- Controles de la cÃ¡mara -->
      <div class="camera-controls">
        <button (click)="toggleCamera()" class="control-btn camera-btn" [class.active]="isCameraOn">
          <span class="btn-icon">{{ isCameraOn ? 'ğŸ“·' : 'ğŸ“·' }}</span>
          <span class="btn-text">{{ isCameraOn ? 'Detener CÃ¡mara' : 'Activar CÃ¡mara' }}</span>
        </button>
        
        <button (click)="startScanning()" class="control-btn scan-btn" [disabled]="!isCameraOn || isScanning">
          <span class="btn-icon">ğŸ”</span>
          <span class="btn-text">{{ isScanning ? 'Escaneando...' : 'Iniciar Escaneo' }}</span>
        </button>
        
        <button (click)="stopScanning()" class="control-btn stop-btn" [disabled]="!isScanning">
          <span class="btn-icon">â¹ï¸</span>
          <span class="btn-text">Detener</span>
        </button>
      </div>

      <!-- Mensajes de estado -->
      <div *ngIf="errorMessage" class="status-message" 
           [ngClass]="{'success': errorMessage.includes('exitosamente'), 'error': !errorMessage.includes('exitosamente'), 'info': errorMessage.includes('Buscando') || errorMessage.includes('Escaneando')}">
        <div class="message-icon">
          <span *ngIf="errorMessage.includes('exitosamente')">âœ…</span>
          <span *ngIf="!errorMessage.includes('exitosamente') && !errorMessage.includes('Buscando') && !errorMessage.includes('Escaneando')">âš ï¸</span>
          <span *ngIf="errorMessage.includes('Buscando') || errorMessage.includes('Escaneando')">â³</span>
        </div>
        <div class="message-text">{{ errorMessage }}</div>
      </div>
    </div>
  </div>

  <!-- Formulario de crear producto usando el componente reutilizable -->
  <div class="seccion-formulario">
    <app-producto-form
      [producto]="producto"
      [isLoading]="isLoading"
      [errorMessage]="errorMessage"
      [showForm]="showCreateForm"
      [title]="foundProducts.length > 0 ? 'Crear Producto (Datos Sugeridos)' : 'Crear Nuevo Producto'"
      [submitButtonText]="'Crear Producto'"
      [showBarcodeField]="true"
      [showStoreIdField]="true"
      [suggestedData]="foundProducts"
      (onSubmit)="onProductoSubmit($event)"
      (onCancel)="onCancelar()"
      (onReset)="onReset()"
      (onUseSuggestedData)="onUseSuggestedData($event)">
    </app-producto-form>

    <!-- InformaciÃ³n adicional cuando hay productos encontrados -->
    <div *ngIf="foundProducts.length > 0 && showCreateForm" class="found-products-info">
      <h4>ğŸ” InformaciÃ³n del Escaneo</h4>
      <p><strong>CÃ³digo escaneado:</strong> {{ scannedBarcode }}</p>
      <p><strong>Tienda:</strong> {{ currentStore?.name || 'No especificada' }}</p>
      <p><strong>Productos similares encontrados:</strong> {{ foundProducts.length }}</p>
    </div>

  </div>
</div>