<app-sidebar></app-sidebar>

<div class="contenedor-principal">
  <!-- SecciÃ³n de cÃ¡mara -->
  <div class="seccion-camara">
    <div class="cuadrado-escanear">
      <h1>Escanear</h1>
      <div class="color-box">
        Escanear producto
      </div>
      <img src="assets/img/logo.png" alt="Ingresar cÃ³digo QR" />
    </div>

    <h2>CÃ¡mara</h2>

    <div *ngIf="currentStore" class="store-info">
      <h3>ğŸª Tienda: {{ currentStore.name }}</h3>
      <p>ğŸ“ {{ currentStore.address }}</p>
    </div>

    <div class="video-container">
      <div #video id="scanner-container"></div>
      <div class="video-overlay" *ngIf="!isCameraOn">
        <p>ğŸ“· CÃ¡mara desactivada</p>
      </div>
    </div>

    <div class="camera-controls">
      <button (click)="toggleCamera()" class="camera-btn" [class.active]="isCameraOn">
        {{ isCameraOn ? 'ğŸ“· Detener CÃ¡mara' : 'ğŸ“· Activar CÃ¡mara' }}
      </button>
      
      <button (click)="startScanning()" class="scan-btn" [disabled]="!isCameraOn || isScanning">
        {{ isScanning ? 'â³ Escaneando...' : 'ğŸ” Iniciar Escaneo' }}
      </button>
      
      <button (click)="stopScanning()" class="stop-btn" [disabled]="!isScanning">
        â¹ï¸ Detener Escaneo
      </button>
    </div>

    <div *ngIf="errorMessage" class="message" 
         [ngClass]="{'success': errorMessage.includes('exitosamente'), 'error': !errorMessage.includes('exitosamente')}">
      {{ errorMessage }}
    </div>
  </div>

  <!-- Formulario de crear producto usando el componente reutilizable -->
  <div class="seccion-formulario">
    <app-crear-producto-form
      [producto]="producto"
      [isLoading]="isLoading"
      [errorMessage]="errorMessage"
      [showForm]="showCreateForm"
      [title]="foundProducts.length > 0 ? 'Crear Producto (Datos Prellenados)' : 'Crear Nuevo Producto'"
      [submitButtonText]="'Crear Producto'"
      (onSubmit)="onProductoSubmit($event)"
      (onCancel)="onCancelar()"
      (onReset)="onReset()">
    </app-crear-producto-form>

    <!-- InformaciÃ³n adicional cuando hay productos encontrados -->
    <div *ngIf="foundProducts.length > 0 && showCreateForm" class="found-products-info">
      <h4>ğŸ” InformaciÃ³n del Escaneo</h4>
      <p><strong>CÃ³digo escaneado:</strong> {{ scannedBarcode }}</p>
      <p><strong>Tienda:</strong> {{ currentStore?.name || 'No especificada' }}</p>
      <p><strong>Productos similares encontrados:</strong> {{ foundProducts.length }}</p>
    </div>

    <!-- Datos escaneados para mostrar informaciÃ³n -->
    <div *ngIf="!showCreateForm" class="datos-escaneados">
      <h2>Datos Escaneados</h2>
      <div class="formulario-datos">
        <div class="campo-dato">
          <label>Nombre:</label>
          <span>{{ datosEscaneados.nombre || '--' }}</span>
        </div>

        <div class="campo-dato">
          <label>Tipo:</label>
          <span>{{ datosEscaneados.tipo || '--' }}</span>
        </div>

        <div class="campo-dato">
          <label>CÃ³digo:</label>
          <span>{{ datosEscaneados.codigo || '--' }}</span>
        </div>

        <div class="campo-dato">
          <label>Precio:</label>
          <span>{{ datosEscaneados.precio ? '$' + datosEscaneados.precio : '--' }}</span>
        </div>

        <div class="campo-dato">
          <label>Fecha:</label>
          <span>{{ datosEscaneados.fecha }}</span>
        </div>
      </div>

      <div class="acciones-formulario">
        <button (click)="simularEscaneo()" class="btn-simular">
          ğŸ² Simular Escaneo
        </button>
        <button (click)="imprimirDatos()" [disabled]="!datosEscaneados.nombre" class="btn-imprimir">
          ğŸ–¨ï¸ Imprimir
        </button>
        <button (click)="limpiarFormulario()" class="btn-limpiar">
          ğŸ—‘ï¸ Limpiar
        </button>
      </div>
    </div>
  </div>
</div>